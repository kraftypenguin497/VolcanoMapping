import numpy as np
import pandas as pd
import geopandas as gpd
import contextily as ctx # for basemaps
from shapely.geometry import Point, LineString, Polygon
from matplotlib import pyplot as plt
import folium

volcano_df = pd.read_csv("volcano_db.csv")
volcano_df = volcano_df.drop(' Search Parameters', axis = 1)
volcano_df = volcano_df.dropna()
volcano_df

coordinates = [[29.69586416231931, -1.3533133508295379 ],[ 29.676962804256817, -1.3492055026080578 ],[ 29.66299223525388, -1.359885893504071 ],[ 29.64080368448333, -1.3483839321307158 ],[ 29.61204074829999, -1.3557780564241426 ],[ 29.567663636532473, -1.3393466361280275 ],[ 29.5446532875861, -1.3294877324720318 ],[ 29.542187893055484, -1.3368819139212462 ],[ 29.520821140462402, -1.3409897828889825 ],[ 29.50849416781267, -1.3500270703211328 ],[ 29.46329526763742, -1.3492055009295143 ],[ 29.42373571793709, -1.378292055593576 ],[ 29.424557516112827, -1.3947232068746303 ],[ 29.368675240101055, -1.4358005801985598 ],[ 29.291426211494496, -1.3289979268996177 ],[ 29.25280169719207, -1.3503588389414176 ],[ 29.196919421180297, -1.3733626880390233 ],[ 29.159116705053606, -1.416083531823503 ],[ 29.16651288864378, -1.444015966961345 ],[ 29.18870143941436, -1.4546959253355993 ],[ 29.21108451113838, -1.5051440342477065 ],[ 29.19875753848862, -1.5338968556006165 ],[ 29.19875753848862, -1.5519698602909244 ],[ 29.237614284767915, -1.5817236897781157 ],[ 29.258367429132278, -1.578944904149111 ],[ 29.284114673603057, -1.5728708059604202 ],[ 29.297788274164873, -1.5537345773046098 ],[ 29.308261226980335, -1.5365131483410153 ],[ 29.318335182428825, -1.516363344453083 ],[ 29.32211333054974, -1.5074040441216425 ],[ 29.344567719232344, -1.5044278029498486 ],[ 29.364697072424832, -1.5043751600132254 ], [ 29.379402639090245, -1.5390757099580412 ], [ 29.388433919394288, -1.550586571400217 ], [ 29.42215956289479, -1.5790552488692384 ], [ 29.481513345369592, -1.569849538964121 ], [ 29.52095678963468, -1.5566907388204072 ], [ 29.5390893099481, -1.5292973966769523],[29.540158429924134,-1.5128922919543868], [29.511359149635126,-1.4606054815081961],[29.513443955364295,-1.4486718068155398],[29.526994222524337,-1.4392166767010082],[29.55646697614074,-1.4336474832305157],[29.57874576730333,-1.4242844387093498],[29.603222582801124,-1.41818899575685],[29.637351830067075,-1.4297440915384385],[29.663202328121855,-1.4448950921956651],[29.680855400515668,-1.4375640331870443],[29.711641630279757,-1.4242966963131494],[29.725466266590075,-1.400840784050132],[29.732223270461844,-1.3747033913821838],[29.71259278118447,-1.3532326617867483], [29.69586416231931,-1.3533133508295379]]
poly = Polygon(coordinates)
poly.bounds

query = ((volcano_df['Longitude']) > 29.159116705053606 ) & ((volcano_df['Latitude']) > -1.5817236897781157 ) & ((volcano_df['Longitude']) < 29.732223270461844 ) & ((volcano_df['Latitude']) < -1.3289979268996177 )
virungas_df = volcano_df.loc[query]
virungas_df.insert(4, 'Pop. 30km', [1198124, 711356, 1006436, 1162209, 1189226])
virungas_df

virungas_df.sort_values('Pop. 30km', ascending=False)

lat_to_km = 1/110.574
karisimbi_radius = Point(29.450, -1.506).buffer(5 * lat_to_km)
muhavura_radius = Point(29.678, -1.383).buffer(5 * lat_to_km)
visoke_radius = Point(29.485, -1.458	).buffer(5 * lat_to_km)
nyiragongo_radius = Point(29.250, -1.520	).buffer(5 * lat_to_km)
nyamulagira_radius = Point(29.200, -1.408).buffer(5 * lat_to_km)
karisimbi_gdf = gpd.GeoDataFrame(geometry = [karisimbi_radius], crs = "epsg:4326")
muhavura_gdf = gpd.GeoDataFrame(geometry = [muhavura_radius], crs = "epsg:4326")
visoke_gdf = gpd.GeoDataFrame(geometry = [visoke_radius], crs = "epsg:4326")
nyiragongo_gdf = gpd.GeoDataFrame(geometry = [nyiragongo_radius], crs = "epsg:4326")
nyamulagira_gdf = gpd.GeoDataFrame(geometry = [nyamulagira_radius], crs = "epsg:4326")
joined_gdf = pd.concat([karisimbi_gdf ,muhavura_gdf, visoke_gdf, nyiragongo_gdf, nyamulagira_gdf])

polygon_gdf = gpd.GeoDataFrame(geometry = [poly], crs = "epsg:4326")
polygon_gdf

m = polygon_gdf.explore()
m = joined_gdf.explore(m = m)
volcano_gdf = gpd.GeoDataFrame(virungas_df, geometry = gpd.points_from_xy(virungas_df['Longitude'], virungas_df['Latitude']), crs = "epsg:4326")
volcano_gdf.dropna().explore(m = m)
